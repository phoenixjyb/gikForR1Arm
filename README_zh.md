# R1 机器人手臂 GIK 与抓取项目

## 项目简介
本项目基于 MATLAB，提供了 R1 机器人手臂的稳健仿真与抓取运动规划流程。包含左臂独立工作空间采样、桌面与纸箱避障、自动瓶子放置等功能，确保抓取动作可行且安全。

## 主要功能
- **广义逆运动学（GIK）**：三阶段抓取（接近、抓取、闭合）
- **左臂独立工作空间采样**：`sampleReachableWorkspace` 仅采样左臂关节（躯干和右臂锁定）
- **自动瓶子放置**：若初始位置不可达，自动移动到可达位置
- **桌面与纸箱避障**：瓶子、桌面、纸箱均参与碰撞检测
- **机器人、瓶子、桌面、纸箱与轨迹的可视化**
- **结构清晰、模块化代码**，便于扩展和适配

## 分支结构
- **master**：干净、生产可用主分支
- **feature/robust-grasping-workflow**：主开发分支（推荐后续开发）
- **backupFiles-only**：历史/实验脚本与备份，仅供参考，不参与主流程

## 环境配置
1. 克隆本仓库并在 MATLAB 中打开。
2. 确保所有文件在主目录下，URDF 文件在 `fineUrdfs/` 文件夹。
3. 运行 `createAndPlaceBottleTable.m` 生成瓶子、桌面和纸箱对象。
4. 运行 `simpleGIKprocess_R1BodyAndMug.m` 仿真抓取流程并可视化结果。

## 主要脚本
- **`createAndPlaceBottleTable.m`**：
  - 加载机器人，仅采样左臂工作空间，创建瓶子、桌面和纸箱。
  - 检查瓶子的抓取位姿是否可达，不可达则自动移动并用 IK 验证。
- **`simpleGIKprocess_R1BodyAndMug.m`**：
  - 执行三阶段 GIK 流程（接近、抓取、闭合）
  - 动画展示机器人、瓶子、桌面和纸箱
  - 打印并保存最终位姿

## 主要流程与步骤（simpleGIKprocess_R1BodyAndMug.m）
该脚本展示了 R1 机器人在避障条件下完成瓶子抓取的完整流程，主要步骤如下：

1. **初始化与设置**：加载机器人和环境对象，调整瓶子姿态，设置初始机器人配置。
2. **环境与碰撞体设置**：将桌面和纸箱作为碰撞体添加，定义需保护的机器人连杆，设置安全距离约束。
3. **逆运动学与可达性检查**：配置 GIK 求解器，设定目标和接近位姿，仅用左臂检查可达性。
4. **躯干调整以提升可达性**：如不可达，采样不同躯干关节组合以实现可达。
5. **基于 GIK 的抓取规划**：锁定除左臂和夹爪外的关节，分三阶段（接近、抓取、闭合）求解，保持避障约束。
6. **碰撞检测**：检查初始和抓取配置的碰撞情况，若有则可视化并报告。
7. **运动规划**：使用 RRT 规划从初始到抓取的无碰撞路径，考虑所有障碍物。
8. **最终位姿与指标**：打印并比较夹爪、手指和瓶子的最终位置。
9. **动画与可视化**：动画展示机器人运动，导出视频，绘制轨迹。
10. **数据导出**：保存最终配置和轨迹为 .mat 和 .json 文件。
11. **辅助函数**：包含躯干求解、可达性采样和多阶段 GIK 等辅助函数。
12. **路径全程碰撞检查**：对规划路径的每一步进行碰撞检测。

## 工作空间采样
- `sampleReachableWorkspace(robot, eeName, numSamples, visualize, jointsToSample)` 仅采样左臂关节（躯干和右臂锁定），计算末端执行器的可达空间。
- 支持连续关节与无效采样的鲁棒处理。
- 可选可视化。

## 自动瓶子放置
- 采样后，脚本检查瓶子的抓取位姿是否在任一采样点 5cm 内。
- 若不可达，自动移动到最近的采样点，并用 IK 验证。
- 仅在 IK 成功时更新瓶子，确保放置可行。

## 常见问题
- 若提示瓶子不可达，脚本会自动尝试移动。
- 请确保所有依赖文件（URDF、辅助函数）在正确位置。
- 如需适配新物体或机器人，请修改相关脚本和 URDF 路径。

## 扩展说明
- 可通过修改 `generateBottleAndTable.m` 适配其他物体。
- 工作空间采样函数可用于任意机器人和末端执行器，通过 jointsToSample 参数指定。

## 历史/实验代码
- `backupFiles-only` 分支包含历史脚本和实验代码，主流程无需使用。

## 许可证
MIT License。详见 LICENSE 文件。 